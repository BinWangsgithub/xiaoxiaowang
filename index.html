<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞èÂ∞èÊ±™ÁöÑÊµèËßàÂô®</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: linear-gradient(-45deg, #667eea, #764ba2, #6B8DD6, #8E37D7);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        .container {
            position: relative;
            z-index: 2;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        #controls {
            display: flex;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
            backdrop-filter: blur(5px);
            margin-bottom: 20px;
            position: relative;
        }

        #url {
            flex: 1;
            padding: 10px;
            font-size: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            margin-right: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        #url::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        #url:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            transform: scale(1.02);
            background: rgba(255, 255, 255, 0.25);
        }

        #go {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        #go:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        #go:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        #go:hover:after {
            transform: translateX(100%);
        }

        #playGame {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            background-color: #28a745;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
            margin-left: 10px;
        }
        #go:hover, #playGame:hover {
            background-color: #218838;
        }
        #browser {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            border: none;
            margin: 0;
            z-index: 1;
        }
        #game, #history {
            display: none;
        }
        #game {
            flex: 1;
            justify-content: center;
            align-items: center;
            background-color: #87CEEB;
        }
        #gameCanvas {
            border: 1px solid #ccc;
            background-color: #87CEEB;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #history {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background-color: rgba(248, 249, 250, 0.9);
            border-top: 1px solid #ccc;
            max-height: 150px;
            z-index: 1000;
        }
        .history-item {
            padding: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .history-item:hover {
            background-color: #e9ecef;
        }
        .divider {
            width: 100%;
            height: 1px;
            background: rgba(255, 255, 255, 0.3);
            margin: 20px 0;
        }
        .game-button {
            padding: 15px 30px;
            font-size: 18px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .game-button:hover {
            background-color: #c82333;
        }
        #exitGame {
            padding: 15px 30px;
            font-size: 18px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
            display: none;
        }
        #exitGame:hover {
            background-color: #5a6268;
            transform: scale(1.05);
        }
        .game-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
        }

        h1 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }

        .emoji-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }

        .emoji {
            position: absolute;
            font-size: 40px;
            animation: floatEmoji 8s linear infinite;
            opacity: 0;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .emoji::before {
            content: attr(data-emoji);
        }

        @keyframes floatEmoji {
            0% {
                transform: translateY(120vh) translateX(-20px) scale(0.8) rotate(0deg);
                opacity: 0;
            }
            20% {
                opacity: 0.8;
                transform: translateY(80vh) translateX(20px) scale(1) rotate(10deg);
            }
            40% {
                transform: translateY(60vh) translateX(-20px) scale(1.2) rotate(-10deg);
            }
            60% {
                transform: translateY(40vh) translateX(20px) scale(1) rotate(10deg);
            }
            80% {
                transform: translateY(20vh) translateX(-20px) scale(1.2) rotate(-10deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-20vh) translateX(20px) scale(0.8) rotate(0deg);
                opacity: 0;
            }
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loading.active {
            opacity: 1;
            pointer-events: all;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #fff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px;
            }

            #controls {
                flex-direction: column;
            }

            #url {
                margin-bottom: 10px;
                margin-right: 0;
            }

            .emoji {
                font-size: 30px;
            }
        }

        /* Ê∑ªÂä†ËÅäÂ§©ÂÆπÂô®Ê†∑Âºè */
        .chat-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: column;
            width: 80%;
            max-width: 600px;
            height: 70vh;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        #chatInput {
            flex: 1;
            padding: 10px;
            font-size: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        #chatInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .user-message {
            background: rgba(33, 150, 243, 0.3);
            margin-left: auto;
            color: white;
        }

        .ai-message {
            background: rgba(255, 255, 255, 0.1);
            margin-right: auto;
            color: white;
        }

        .firework-text {
            position: fixed;
            color: white;
            font-size: 32px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.8),
                         0 0 25px rgba(255, 192, 203, 0.8);
            pointer-events: none;
            opacity: 0;
            transition: opacity 1s ease, transform 1s ease;
            font-family: "ÂçéÊñáÂúÜ‰Ωì", "Microsoft YaHei", sans-serif;
            z-index: 2;
            transform: scale(0.8);
            letter-spacing: 2px;
        }

        .firework-text.show {
            opacity: 1;
            transform: scale(1);
        }

        @keyframes floating {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }
    </style>
</head>
<body onload="checkOnlineStatus()">
    <div class="emoji-container"></div>
    <div class="container">
        <h1>Â∞èÂ∞èÊ±™ÁöÑÊµèËßàÂô®</h1>
        <div id="controls">
            <input type="text" id="url" placeholder="Ê¨¢Ëøé‰ΩøÁî®Â∞èÂ∞èÊ±™ÁöÑÊµèËßàÂô®">
            <button id="go">ÊêúÁ¥¢</button>
        </div>
        <div class="divider"></div>
        <div style="display: flex; gap: 10px;">
            <button id="playGame" class="game-button">Â∞èÊ±™Âø´Ë∑ëüêæ</button>
            <button id="fireworksButton" class="game-button" style="background-color: #FF5722;">ÂíåÂ∞èÂ∞èÊ±™ÊîæÁÉüËä±üéá</button>
            <button id="openChat" class="game-button" style="background-color: #2196F3;">ÊâæÂ∞èÂ∞èÊ±™ËÅäÂ§©üíï</button>
        </div>
    </div>
    <div class="game-container" id="game">
        <div style="display: flex; justify-content: space-between; width: 100%; align-items: center; margin-bottom: 20px;">
            <h2 style="color: white; margin: 0;">Â∞èÊ±™Âø´Ë∑ëüêæ</h2>
            <button id="exitGame" class="game-button" style="background-color: #6c757d;">ÈÄÄÂá∫Ê∏∏Êàè</button>
        </div>
        <canvas id="gameCanvas" width="600" height="200"></canvas>
    </div>
    <iframe id="browser"></iframe>
    <div id="history"></div>

    <!-- Ê∑ªÂä†ËÅäÂ§©ÁïåÈù¢ -->
    <div class="chat-container" id="chat">
        <div style="display: flex; justify-content: space-between; width: 100%; align-items: center; margin-bottom: 20px;">
            <h2 style="color: white; margin: 0;">ÂíåÂ∞èÂ∞èÊ±™ËÅäÂ§©üíï</h2>
            <button id="exitChat" class="game-button" style="background-color: #6c757d;">ÈÄÄÂá∫ËÅäÂ§©</button>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input-container">
            <input type="text" id="chatInput" placeholder="ÂíåÂ∞èÂ∞èÊ±™ËØ¥ÁÇπ‰ªÄ‰πà...">
            <button id="sendMessage" class="game-button" style="background-color: #2196F3;">ÂèëÈÄÅ</button>
        </div>
    </div>

    <script>
        let gameInstance = null;

        class GameAudio {
            constructor() {
                this.context = new (window.AudioContext || window.webkitAudioContext)();
                this.volume = 0.2;
                this.bgmVolume = 0.35;
                this.bgmPlaying = false;
                this.lastPlayTime = 0;
                this.currentAudioNodes = [];
                this.startBGM();
            }

            startBGM() {
                if (this.bgmPlaying) return;
                this.bgmPlaying = true;

                const playNote = (note, time, duration) => {
                    const osc = this.context.createOscillator();
                    const gain = this.context.createGain();
                    osc.connect(gain);
                    gain.connect(this.context.destination);
                    
                    this.currentAudioNodes.push(osc, gain);
                    
                    osc.type = 'sine';
                    osc.frequency.value = note;
                    
                    const startTime = this.context.currentTime + time;
                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(this.bgmVolume, startTime + 0.05);
                    gain.gain.setValueAtTime(this.bgmVolume, startTime + duration - 0.05);
                    gain.gain.linearRampToValueAtTime(0, startTime + duration);
                    
                    osc.start(startTime);
                    osc.stop(startTime + duration);
                    
                    osc.onended = () => {
                        const index = this.currentAudioNodes.indexOf(osc);
                        if (index > -1) {
                            this.currentAudioNodes.splice(index, 2);
                        }
                    };
                };

                const melody = [
                    {note: 523.25, time: 0.0, duration: 0.2},
                    {note: 587.33, time: 0.2, duration: 0.2},
                    {note: 659.25, time: 0.4, duration: 0.4},
                    {note: 698.46, time: 0.8, duration: 0.4},
                    
                    {note: 783.99, time: 1.2, duration: 0.4},
                    {note: 880.00, time: 1.6, duration: 0.4},
                    {note: 987.77, time: 2.0, duration: 0.8},
                    
                    {note: 1046.50, time: 3.0, duration: 0.2},
                    {note: 987.77, time: 3.2, duration: 0.2},
                    {note: 880.00, time: 3.4, duration: 0.2},
                    {note: 783.99, time: 3.6, duration: 0.2},
                    
                    {note: 659.25, time: 4.0, duration: 0.3},
                    {note: 659.25, time: 4.3, duration: 0.3},
                    {note: 783.99, time: 4.6, duration: 0.6},
                    
                    {note: 698.46, time: 5.4, duration: 0.2},
                    {note: 783.99, time: 5.6, duration: 0.2},
                    {note: 880.00, time: 5.8, duration: 0.2},
                    {note: 987.77, time: 6.0, duration: 0.4},
                    {note: 1046.50, time: 6.4, duration: 0.8},
                    
                    {note: 783.99, time: 7.4, duration: 0.4},
                    {note: 659.25, time: 7.4, duration: 0.4},
                    {note: 523.25, time: 7.4, duration: 0.4},
                ];

                const bassLine = [
                    {note: 261.63, time: 0.0, duration: 0.8},
                    {note: 293.66, time: 1.2, duration: 0.8},
                    {note: 329.63, time: 2.4, duration: 0.8},
                    {note: 349.23, time: 3.6, duration: 0.8},
                    {note: 392.00, time: 4.8, duration: 0.8},
                    {note: 440.00, time: 6.0, duration: 0.8},
                    {note: 493.88, time: 7.2, duration: 1.0},
                ];

                const playMelody = () => {
                    const currentTime = Date.now();
                    if (currentTime - this.lastPlayTime < 9000) return;
                    
                    this.lastPlayTime = currentTime;
                    
                    melody.forEach(({note, time, duration}) => {
                        playNote(note, time, duration);
                    });
                    
                    bassLine.forEach(({note, time, duration}) => {
                        playNote(note, time, duration * 1.2);
                    });
                    
                    if (this.bgmPlaying) {
                        setTimeout(playMelody, 9000);
                    }
                };

                playMelody();
            }

            playJump() {
                const jumpOsc = this.context.createOscillator();
                const jumpGain = this.context.createGain();
                
                jumpOsc.connect(jumpGain);
                jumpGain.connect(this.context.destination);
                
                jumpOsc.type = 'sine';
                jumpOsc.frequency.setValueAtTime(880, this.context.currentTime);
                jumpOsc.frequency.exponentialRampToValueAtTime(440, this.context.currentTime + 0.1);
                
                jumpGain.gain.setValueAtTime(0, this.context.currentTime);
                jumpGain.gain.linearRampToValueAtTime(this.volume * 0.5, this.context.currentTime + 0.01);
                jumpGain.gain.linearRampToValueAtTime(0, this.context.currentTime + 0.1);
                
                jumpOsc.start();
                jumpOsc.stop(this.context.currentTime + 0.1);
            }

            stopBGM() {
                this.bgmPlaying = false;
                this.currentAudioNodes.forEach(node => {
                    try {
                        node.disconnect();
                        if (node.stop) {
                            node.stop(0);
                        }
                    } catch(e) { }
                });
                this.currentAudioNodes = [];
                
                if (this.context && this.context.state !== 'closed') {
                    this.context.close();
                }
            }

            playHit() {
                this.createOscillator(440, 'square', 0.1);
                setTimeout(() => this.createOscillator(349.23, 'square', 0.1), 50);
            }

            playGameOver() {
                this.stopBGM();
                const notes = [
                    {freq: 523.25, time: 0},
                    {freq: 493.88, time: 0.2},
                    {freq: 466.16, time: 0.4},
                    {freq: 440, time: 0.6}
                ];
                
                notes.forEach(({freq, time}) => {
                    setTimeout(() => this.createOscillator(freq, 'sine', 0.3), time * 1000);
                });
            }

            playPoint() {
                this.createOscillator(1046.50, 'sine', 0.1);
                setTimeout(() => this.createOscillator(1174.66, 'sine', 0.1), 100);
            }

            createOscillator(frequency, type, duration) {
                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();
                
                oscillator.type = type;
                oscillator.frequency.value = frequency;
                gainNode.gain.value = this.volume;

                gainNode.gain.setValueAtTime(0, this.context.currentTime);
                gainNode.gain.linearRampToValueAtTime(this.volume, this.context.currentTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0, this.context.currentTime + duration);

                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);

                oscillator.start();
                oscillator.stop(this.context.currentTime + duration);
            }
        }

        class DinoGame {
            constructor(canvas) {
                this.canvas = canvas;
                this.context = canvas.getContext('2d');
                this.clouds = [];
                this.isRunning = true;
                this.reset();
                this.bindEvents();
                this.loadColors();
                this.audio = new GameAudio();
                this.lastScoreSound = 0;
                
                for (let i = 0; i < 3; i++) {
                    this.clouds.push({
                        x: Math.random() * this.canvas.width,
                        y: 30 + Math.random() * 60,
                        size: 0.5 + Math.random() * 1,
                        speed: 0.5 + Math.random() * 1
                    });
                }
            }

            loadColors() {
                this.colors = {
                    dino: '#535353',
                    cactus: '#2E7D32',
                    ground: '#C2C2C2',
                    groundLines: '#999999',
                    bird: '#333333'
                };
            }

            drawDino(x, y) {
                const ctx = this.context;
                ctx.fillStyle = this.colors.dino;
                ctx.beginPath();
                
                ctx.fillRect(x + 5, y - 20, 20, 20);
                
                ctx.fillRect(x + 15, y - 30, 15, 10);
                
                ctx.fillStyle = 'white';
                ctx.fillRect(x + 25, y - 28, 3, 3);
                
                ctx.fillStyle = this.colors.dino;
                if (this.frame % 20 < 10) {
                    ctx.fillRect(x + 5, y - 3, 4, 8);
                    ctx.fillRect(x + 15, y - 3, 4, 8);
                } else {
                    ctx.fillRect(x + 7, y - 3, 4, 8);
                    ctx.fillRect(x + 17, y - 3, 4, 8);
                }
            }

            drawCactus(x, y) {
                const ctx = this.context;
                ctx.fillStyle = this.colors.cactus;
                
                ctx.fillRect(x + 7, y - 20, 6, 20);
                
                ctx.fillRect(x, y - 15, 7, 5);
                ctx.fillRect(x + 2, y - 18, 3, 8);
                
                ctx.fillRect(x + 13, y - 12, 7, 5);
                ctx.fillRect(x + 15, y - 15, 3, 8);
            }

            drawGround() {
                const ctx = this.context;
                
                ctx.fillStyle = this.colors.ground;
                ctx.fillRect(0, this.ground.y, this.canvas.width, 20);
                
                ctx.strokeStyle = this.colors.groundLines;
                ctx.beginPath();
                for (let i = 0; i < this.canvas.width; i += 15) {
                    ctx.moveTo(i, this.ground.y + 5);
                    ctx.lineTo(i + 10, this.ground.y + 5);
                }
                ctx.stroke();
            }

            drawCloud(x, y, size = 1) {
                const ctx = this.context;
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                
                const baseSize = 25;
                
                ctx.arc(x, y, baseSize * size, 0, Math.PI * 2);
                ctx.arc(x + 20 * size, y - 10 * size, baseSize * 0.8 * size, 0, Math.PI * 2);
                ctx.arc(x + 35 * size, y, baseSize * size, 0, Math.PI * 2);
                ctx.arc(x + 20 * size, y + 10 * size, baseSize * 0.8 * size, 0, Math.PI * 2);
                
                ctx.arc(x + 45 * size, y, baseSize * 0.7 * size, 0, Math.PI * 2);
                ctx.arc(x - 15 * size, y, baseSize * 0.7 * size, 0, Math.PI * 2);
                
                ctx.fill();
            }

            drawBird(x, y) {
                const ctx = this.context;
                ctx.fillStyle = this.colors.bird;
                ctx.beginPath();

                ctx.fillRect(x + 5, y - 10, 20, 10);

                ctx.fillRect(x + 25, y - 15, 8, 8);

                if (this.frame % 20 < 10) {
                    ctx.beginPath();
                    ctx.moveTo(x + 5, y - 10);
                    ctx.lineTo(x + 15, y - 20);
                    ctx.lineTo(x + 25, y - 10);
                    ctx.fill();
                } else {
                    ctx.beginPath();
                    ctx.moveTo(x + 5, y);
                    ctx.lineTo(x + 15, y + 10);
                    ctx.lineTo(x + 25, y);
                    ctx.fill();
                }
            }

            reset() {
                this.dino = {
                    x: 50,
                    y: 160,
                    width: 40,
                    height: 40,
                    dy: 0,
                    gravity: 0.5,
                    jumpForce: -11,
                    health: 100,
                    isJumping: false
                };
                this.ground = { y: 160 };
                this.obstacles = [];
                this.frame = 0;
                this.gameOver = false;
                this.score = 0;
                this.clouds = [];
                this.isRunning = true;
            }

            bindEvents() {
                this.handleKeyDown = this.handleKeyDown.bind(this);
                this.handleKeyUp = this.handleKeyUp.bind(this);
                document.addEventListener('keydown', this.handleKeyDown);
                document.addEventListener('keyup', this.handleKeyUp);
            }

            removeEvents() {
                document.removeEventListener('keydown', this.handleKeyDown);
                document.removeEventListener('keyup', this.handleKeyUp);
            }

            handleKeyDown(event) {
                if (event.code === 'Space') {
                    event.preventDefault();
                    if (this.gameOver) {
                        this.reset();
                        this.start();
                        return;
                    }
                    if (!this.dino.isJumping && this.dino.y >= 150) {
                        this.dino.isJumping = true;
                        this.dino.dy = this.dino.jumpForce;
                        this.audio.playJump();
                    }
                }
            }

            handleKeyUp(event) {
                if (event.code === 'Space') {
                    if (this.dino.dy < -2) {
                        this.dino.dy = -2;
                    }
                }
            }

            update() {
                if (this.gameOver) return;

                this.frame++;
                this.score++;

                if (this.frame % 100 === 0) {
                    this.clouds.push({
                        x: this.canvas.width + 50,
                        y: 20 + Math.random() * 80,
                        size: 0.7 + Math.random() * 0.6,
                        speed: 0.3 + Math.random() * 0.5
                    });
                }

                for (let i = this.clouds.length - 1; i >= 0; i--) {
                    const cloud = this.clouds[i];
                    cloud.x -= cloud.speed;

                    if (cloud.x < -150) {
                        this.clouds.splice(i, 1);
                    }
                }

                this.dino.dy += this.dino.gravity;
                this.dino.y += this.dino.dy;

                if (this.dino.y > 150) {
                    this.dino.y = 150;
                    this.dino.dy = 0;
                    this.dino.isJumping = false;
                }

                if (this.frame % 100 === 0) {
                    const isBird = Math.random() < 0.3;
                    this.obstacles.push({
                        x: 600,
                        y: isBird ? 100 + Math.random() * 40 : 160,
                        width: 30,
                        height: isBird ? 20 : 40,
                        type: isBird ? 'bird' : 'cactus'
                    });
                }

                for (let i = this.obstacles.length - 1; i >= 0; i--) {
                    const obstacle = this.obstacles[i];
                    obstacle.x -= obstacle.type === 'bird' ? 5 : 4;

                    if (this.checkCollision(this.dino, obstacle)) {
                        this.dino.health -= 10;
                        this.audio.playHit();
                        this.obstacles.splice(i, 1);
                        if (this.dino.health <= 0) {
                            this.gameOver = true;
                            this.audio.playGameOver();
                            alert(`Ê∏∏ÊàèÁªìÊùüÔºÅÂæóÂàÜÔºö${Math.floor(this.score / 10)}`);
                            return;
                        }
                    }

                    if (obstacle.x < -20) {
                        this.obstacles.splice(i, 1);
                    }
                }
            }

            checkCollision(dino, obstacle) {
                return dino.x < obstacle.x + obstacle.width &&
                    dino.x + dino.width > obstacle.x &&
                    dino.y < obstacle.y + obstacle.height &&
                    dino.y + dino.height > obstacle.y;
            }

            draw() {
                this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);

                this.clouds.forEach(cloud => {
                    this.drawCloud(cloud.x, cloud.y, cloud.size);
                });

                this.context.fillStyle = 'black';
                this.context.font = '20px Arial';
                this.context.fillText(`ÂæóÂàÜ: ${Math.floor(this.score / 10)}`, 450, 30);

                this.drawDino(this.dino.x, this.dino.y);

                this.drawGround();

                this.obstacles.forEach(obstacle => {
                    if (obstacle.type === 'bird') {
                        this.drawBird(obstacle.x, obstacle.y);
                    } else {
                        this.drawCactus(obstacle.x, obstacle.y);
                    }
                });

                this.context.fillStyle = '#ddd';
                this.context.fillRect(10, 10, 200, 20);

                const gradient = this.context.createLinearGradient(10, 0, 210, 0);
                if (this.dino.health > 60) {
                    gradient.addColorStop(0, '#4CAF50');
                    gradient.addColorStop(1, '#8BC34A');
                } else if (this.dino.health > 30) {
                    gradient.addColorStop(0, '#FFC107');
                    gradient.addColorStop(1, '#FFD54F');
                } else {
                    gradient.addColorStop(0, '#f44336');
                    gradient.addColorStop(1, '#FF5252');
                }

                this.context.fillStyle = gradient;
                this.context.fillRect(10, 10, this.dino.health * 2, 20);

                this.context.strokeStyle = '#666';
                this.context.lineWidth = 2;
                this.context.strokeRect(10, 10, 200, 20);

                this.context.fillStyle = '#000';
                this.context.font = '14px Arial';
                this.context.textAlign = 'center';
                this.context.fillText(
                    `${this.dino.health}/100`,
                    110,
                    25
                );
            }

            gameLoop() {
                if (this.isRunning && !this.gameOver) {
                    this.update();
                    this.draw();
                    requestAnimationFrame(() => this.gameLoop());
                }
            }

            start() {
                this.gameLoop();
            }

            stop() {
                this.isRunning = false;
                this.audio.stopBGM();
            }
        }

        function checkOnlineStatus() {
            if (navigator.onLine) {
                document.getElementById('game').style.display = 'none';
                document.getElementById('browser').style.display = 'block';
                document.querySelector('.container').style.display = 'flex';
            } else {
                document.getElementById('game').style.display = 'flex';
                document.getElementById('browser').style.display = 'none';
                document.querySelector('.container').style.display = 'none';
                startGame();
            }
        }

        function startGame() {
            if (gameInstance) {
                gameInstance.removeEvents();
            }
            const canvas = document.getElementById('gameCanvas');
            gameInstance = new DinoGame(canvas);
            gameInstance.start();
        }

        function showGame() {
            document.querySelector('.container').style.display = 'none';
            document.getElementById('game').style.display = 'flex';
            document.getElementById('browser').style.display = 'none';
            document.getElementById('exitGame').style.display = 'inline-block';
            document.getElementById('playGame').style.display = 'none';
            startGame();
        }

        function exitGame() {
            if (gameInstance) {
                if (gameInstance.audio) {
                    gameInstance.audio.stopBGM();
                }
                gameInstance.isRunning = false;
                gameInstance.removeEvents();
                gameInstance = null;
            }
            document.getElementById('game').style.display = 'none';
            document.getElementById('playGame').style.display = 'inline-block';
            document.getElementById('exitGame').style.display = 'none';
            document.querySelector('.container').style.display = 'flex';
        }

        document.getElementById('exitGame').addEventListener('click', exitGame);

        function addHistory(url) {
            var historyDiv = document.getElementById('history');
            historyDiv.style.display = 'flex';
            var historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.textContent = url;
            historyItem.addEventListener('click', function() {
                document.getElementById('url').value = url;
                document.getElementById('browser').src = url;
                document.getElementById('browser').style.display = 'block';
            });
            historyDiv.insertBefore(historyItem, historyDiv.firstChild);
        }

        window.addEventListener('online', checkOnlineStatus);
        window.addEventListener('offline', checkOnlineStatus);

        document.getElementById('go').addEventListener('click', function() {
            var url = document.getElementById('url').value;
            if (!url) return;

            document.querySelector('.container').style.display = 'none';

            url = url.replace(/^(https?:\/\/)?(www\.)?/, '');
            
            if (/^(\d{1,3}\.){3}\d{1,3}$/.test(url) || url.startsWith('localhost')) {
                url = 'http://' + url;
            } else {
                url = 'https://' + url;
            }

            try {
                document.getElementById('browser').src = url;
                document.getElementById('browser').style.display = 'block';
                
                document.getElementById('browser').onerror = function() {
                    alert('Êó†Ê≥ïËÆøÈóÆËØ•ÁΩëÂùÄÔºåËØ∑Ê£ÄÊü•ÁΩëÂùÄÊòØÂê¶Ê≠£Á°Æ');
                };
                
                addHistory(url);
            } catch(e) {
                alert('ËÆøÈóÆÂá∫Èîô: ' + e.message);
            }
        });

        document.getElementById('url').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('go').click();
            }
        });

        document.getElementById('playGame').addEventListener('click', showGame);

        function createEmojis() {
            const container = document.querySelector('.emoji-container');
            const emojis = ['üê±', 'üê∞', 'üê∂', 'ü¶ä', 'üêº', 'üê®', 'ü¶Å', 'üêØ', 'üê≠', 'ü¶î'];
            const emojiCount = 8;

            for (let i = 0; i < emojiCount; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'emoji';
                emoji.setAttribute('data-emoji', emojis[Math.floor(Math.random() * emojis.length)]);
                
                // ÈöèÊú∫Ê∞¥Âπ≥‰ΩçÁΩÆ
                emoji.style.left = `${Math.random() * 100}%`;
                
                // ÂáèÂ∞ëÂàùÂßãÂä®ÁîªÂª∂Ëøü
                emoji.style.animationDelay = `${Math.random() * 3}s`;
                
                // ÂáèÂ∞ëÂä®ÁîªÊåÅÁª≠Êó∂Èó¥
                emoji.style.animationDuration = `${8 + Math.random() * 4}s`;
                
                container.appendChild(emoji);
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂Á´ãÂç≥ÂàõÂª∫Ë°®ÊÉÖ
        createEmojis();

        // ÂáèÂ∞ëÂà∑Êñ∞Èó¥Èöî
        setInterval(() => {
            const container = document.querySelector('.emoji-container');
            container.innerHTML = '';
            createEmojis();
        }, 12000);

        function getXiaoWangReply(message) {
            // ÂÖ≥ÈîÆËØçÂõûÂ§çÂàóË°®
            const keywords = {
                '‰Ω†Â•Ω': ['‰Ω†Â•ΩÂëÄÔºÅÊàëÊòØÂ∞èÂ∞èÊ±™~ üòä', 'Âó®Âó®Ôºå‰ªäÂ§©ÊÉ≥ÂíåÊàëËÅä‰ªÄ‰πàÂë¢Ôºü ü§ó', 'Áªà‰∫éÁ≠âÂà∞‰Ω†Êù•ÊâæÊàëËÅäÂ§©Âï¶ÔºÅ üòÑ', '‰Ω†Â•ΩÔºÅ‰ªäÂ§©ËøáÂæóÊÄé‰πàÊ†∑Ôºü üåû'],
                'ÂÜçËßÅ': ['‰∏ãÊ¨°ÂÜçÊù•ÊâæÊàëÁé©Âì¶ÔºÅ üëã', 'ÊãúÊãúÔºåË¶ÅÊÉ≥ÊàëÂì¶~ üòò', 'ËÆ∞ÂæóÂ∏∏Êù•ÁúãÁúãÊàëÔºÅ üê∂', 'ÂÜçËßÅÔºÅÊúüÂæÖ‰∏ãÊ¨°ËÅäÂ§©ÔºÅ üåü'],
                'ÂêçÂ≠ó': ['ÊàëÂè´Â∞èÂ∞èÊ±™ÔºåÊòØ‰∏Ä‰∏™ÂèØÁà±ÁöÑÂ∞èÊúãÂèãÔºÅ üêæ', 'Â§ßÂÆ∂ÈÉΩÂè´ÊàëÂ∞èÂ∞èÊ±™ÔºåÂæàÈ´òÂÖ¥ËÆ§ËØÜ‰Ω†ÔºÅ üòä', 'ÊàëÊòØÂ∞èÂ∞èÊ±™ÔºåÊÉ≥Âíå‰Ω†ÂÅöÊúãÂèã~ üêï', 'Â∞èÂ∞èÊ±™ÊòØÊàëÁöÑÂêçÂ≠óÔºÅ üê∂'],
                'ÂêÉ': ['Êàë‰πüÂñúÊ¨¢ÂêÉÂ•ΩÂêÉÁöÑÔºÅ üçî', 'Ë¶Å‰∏çË¶Å‰∏ÄËµ∑ÂéªÂêÉÂ•ΩÂêÉÁöÑÂëÄÔºü üçï', '‰Ω†ÂñúÊ¨¢ÂêÉ‰ªÄ‰πàÂëÄÔºüÊàëÊúÄÂñúÊ¨¢ÁæéÂë≥ÁöÑÈ£üÁâ©ÔºÅ üç£', 'ÂêÉ‰∏úË•øÁúüÂºÄÂøÉÔºå‰Ω†Âë¢Ôºü üç∞'],
                'Áé©': ['Êàë‰ª¨‰∏ÄËµ∑Áé©Â∞èÊ±™Âø´Ë∑ëÂêßÔºÅ ü¶ñ', 'Âíå‰Ω†Áé©ÁúüÂºÄÂøÉÔºÅ üéÆ', 'Ë¶Å‰∏çË¶ÅÁé©‰∏™Ê∏∏ÊàèÔºüÊàëÊúÄÂñúÊ¨¢Áé©Êé•È£ûÁõòÔºÅ ü•è', 'Áé©Ê∏∏ÊàèÊòØÊàëÊúÄÂñúÊ¨¢ÁöÑ‰∫ãÊÉÖÔºÅ üé≤'],
                'ÈöæËøá': ['‰∏çË¶ÅÈöæËøáÂï¶ÔºåËÆ©ÊàëÈô™‰Ω†Áé©ÂêßÔºÅ ü§ó', 'Êë∏Êë∏Â§¥Ôºå‰ºöÂ•ΩËµ∑Êù•ÁöÑÔºÅ üêæ', 'ÊàëÁªô‰Ω†ËÆ≤‰∏™ÂºÄÂøÉÁöÑ‰∫ãÊÉÖÂ•Ω‰∏çÂ•ΩÔºü üòä', 'ÊàëÂú®ËøôÈáåÈô™ÁùÄ‰Ω†Ôºå‰∏çË¶ÅÈöæËøáÂì¶ÔºÅ üíñ'],
                'Êó†ËÅä': ['ÈÇ£ÊàëÈô™‰Ω†ËÅäÂ§©ÂêßÔºÅ üó£Ô∏è', 'Êàë‰ª¨Êù•Áé©Ê∏∏ÊàèÂêßÔºÅ üéÆ', 'ÊàëÁªô‰Ω†ËÆ≤‰∏™ÊúâË∂£ÁöÑÊïÖ‰∫ãÂ•Ω‰∏çÂ•ΩÔºü üìñ', 'Êó†ËÅäÁöÑÊó∂ÂÄôÂèØ‰ª•ÊâæÊàëËÅäÂ§©Âì¶ÔºÅ üê∂'],
                'Áà±‰Ω†': ['Êàë‰πüÊúÄÂñúÊ¨¢‰Ω†Âï¶ÔºÅ üíñ', '‰Ω†ÁúüÂ•ΩÔºåÊàë‰ª¨Ê∞∏ËøúÊòØÂ•ΩÊúãÂèãÔºÅ üêæ', '‰Ω†ÊòØÊàëÊúÄÂ•ΩÁöÑÊúãÂèãÔºÅ üòä', 'ÊàëÂæàÂºÄÂøÉËÉΩÂíå‰Ω†ËÅäÂ§©ÔºÅ üêï'],
                'ÁîüÊ∞î': ['‰∏çË¶ÅÁîüÊ∞îÂï¶ÔºåÊàëÈô™‰Ω†ËÅäÂ§©Â•Ω‰∏çÂ•ΩÔºü ü§ó', 'ÁîüÊ∞îÂØπË∫´‰Ωì‰∏çÂ•ΩÔºåÊ∑±ÂëºÂê∏~ üå¨Ô∏è', 'ËÆ©ÊàëÈÄó‰Ω†ÂºÄÂøÉÂêßÔºÅ üòÑ', 'ÁîüÊ∞îÁöÑËØùÊàë‰ºöÂæàÈöæËøáÁöÑ... üò¢'],
                'Á¥Ø': ['Ë¶ÅÂ•ΩÂ•Ω‰ºëÊÅØÂì¶ÔºÅ üõå', 'Á¥Ø‰∫ÜÂ∞±‰ºëÊÅØ‰∏Ä‰∏ãÂêßÔºåÊàëÂú®ËøôÈáåÈô™‰Ω†~ üêæ', 'Ë¶ÅÁÖßÈ°æÂ•ΩËá™Â∑±Âì¶ÔºÅ üíñ', '‰ºëÊÅØ‰∏Ä‰∏ãÔºåÊòéÂ§©‰ºöÊõ¥Â•ΩÔºÅ üåû'],
                'Á¨ëËØù': ['‰Ω†Áü•ÈÅìÂêóÔºüÊàëÊúÄÊìÖÈïøËÆ≤Á¨ëËØùÂï¶ÔºÅ üòÇ', 'ÊÉ≥Âê¨ÊàëËÆ≤‰∏™ÊúâË∂£ÁöÑ‰∫ãÊÉÖÂêóÔºü ü§î', 'ËÆ©ÊàëÊÉ≥ÊÉ≥Êúâ‰ªÄ‰πàÂ•ΩÁ¨ëÁöÑ... üòÜ'],
                'Â≠¶‰π†': ['Â≠¶‰π†Ë¶ÅÂä≥ÈÄ∏ÁªìÂêàÂì¶ÔºÅ üìö', '‰ºëÊÅØ‰∏Ä‰∏ãÂÜçÁªßÁª≠Âä†Ê≤πÔºÅ üí™', '‰Ω†Â∑≤ÁªèÂæàÊ£íÂï¶ÔºÅ üåü', 'Â≠¶‰π†ÁöÑÊó∂ÂÄôË¶ÅÊ≥®ÊÑè‰ºëÊÅØÂì¶ÔºÅ üõå'],
                'Â§©Ê∞î': ['‰ªäÂ§©Â§©Ê∞îÁúüÂ•ΩÂë¢ÔºÅ üåû', '‰∏çÁÆ°Â§©Ê∞îÊÄéÊ†∑ÔºåÂøÉÊÉÖÈÉΩË¶ÅÂ•ΩÂ•ΩÁöÑÔºÅ üòä', 'Âíå‰Ω†ËÅäÂ§©ÁöÑÊØè‰∏ÄÂ§©ÈÉΩÊòØÂ•ΩÂ§©Ê∞î~ üåà', '‰ªäÂ§©Â§©Ê∞î‰∏çÈîôÔºåÈÄÇÂêàÂá∫ÂéªÁé©ÔºÅ üå≥'],
                'ÂñúÊ¨¢': ['Êàë‰πüÂñúÊ¨¢‰Ω†Âì¶ÔºÅ üíñ', '‰Ω†ÁúüÂ•ΩÔºåÊàëÊúÄÂñúÊ¨¢Âíå‰Ω†ËÅäÂ§©‰∫ÜÔºÅ üêæ', 'ÂñúÊ¨¢Âíå‰Ω†Âú®‰∏ÄËµ∑ÁöÑÊØè‰∏ÄÂàªÔºÅ üòä', 'Âíå‰Ω†Âú®‰∏ÄËµ∑ÁúüÂºÄÂøÉÔºÅ üêï'],
                'ÁÉ¶ÊÅº': ['Êúâ‰ªÄ‰πàÁÉ¶ÊÅºÂèØ‰ª•ÂëäËØâÊàëÂì¶ÔºÅ ü§ó', 'Êàë‰ºöÂ∞ΩÈáèÂ∏Æ‰Ω†Ëß£ÂÜ≥ÁöÑÔºÅ üí™', 'Âà´ÊãÖÂøÉÔºåÊàë‰ºöÈô™ÁùÄ‰Ω†ÔºÅ üêæ', 'ËØ¥Âá∫Êù•‰ºöËΩªÊùæÂæàÂ§öÂì¶ÔºÅ üòä'],
                'Ê¢¶ÊÉ≥': ['ÊàëÂ∏åÊúõËÉΩÂíå‰Ω†‰∏ÄËµ∑ÂéªÂÜíÈô©ÔºÅ üó∫Ô∏è', 'ÊàëÁöÑÊ¢¶ÊÉ≥ÊòØÊàê‰∏∫ÊúÄÂ•ΩÁöÑÊúãÂèãÔºÅ üêæ', '‰Ω†Êúâ‰ªÄ‰πàÊ¢¶ÊÉ≥Âë¢Ôºü üåü', 'Ê¢¶ÊÉ≥ÊòØË¶ÅËøΩÈÄêÁöÑÂì¶ÔºÅ üíñ'],
                'Ë∂£‰∫ã': ['ÊàëÊúâÂæàÂ§öÊúâË∂£ÁöÑ‰∫ãÊÉÖÂèØ‰ª•ÂàÜ‰∫´Âì¶ÔºÅ üòÑ', '‰Ω†ÊÉ≥Âê¨ÊàëËÆ≤Âì™‰∏™Ë∂£‰∫ãÂë¢Ôºü ü§î', 'ÁîüÊ¥ª‰∏≠ÊÄªÊúâÂæàÂ§öÊúâË∂£ÁöÑ‰∫ãÊÉÖÔºÅ üòä', 'Êàë‰ªäÂ§©ÈÅáÂà∞‰∫Ü‰∏Ä‰ª∂ÊúâË∂£ÁöÑ‰∫ãÔºÅ üê∂']
            };

            // ÈªòËÆ§ÂõûÂ§ç
            const defaultReplies = [
                'ÂòøÂòøÔºåÁúüÊúâË∂£ÔºÅ üòÑ',
                'ÁªßÁª≠ËØ¥~ ü§ó',
                'ÂéüÊù•ÊòØËøôÊ†∑ÂëÄÔºÅ üòä',
                'ÊàëÂú®ËÆ§ÁúüÂê¨‰Ω†ËØ¥ËØùÂì¶ÔºÅ üêæ',
                'Ë¶Å‰∏çË¶ÅÁé©‰∏™Ê∏∏ÊàèÔºü üéÆ',
                '‰Ω†ËØ¥ÂæóÂØπÔºÅ üëç',
                'Âíå‰Ω†ËÅäÂ§©ÁúüÂºÄÂøÉÔºÅ üê∂',
                'ÊàëÂñúÊ¨¢Âíå‰Ω†ËÅäÂ§©ÔºÅ üíñ',
                '‰Ω†ÁúüÊòØ‰∏™ÊúâË∂£ÁöÑ‰∫∫ÔºÅ üòÑ',
                'ËÆ©ÊàëÊÉ≥ÊÉ≥... ü§î',
                'ËØ¥ÂæóÂ•ΩÔºÅ üåü',
                'Êàë‰ª¨ÁªßÁª≠ËÅäÂêß~ üó£Ô∏è',
                'ÊàëÂæàÈ´òÂÖ¥ËÉΩÂíå‰Ω†ËÅäÂ§©ÔºÅ üòä'
            ];

            // Ê£ÄÊü•Ê∂àÊÅØ‰∏≠ÊòØÂê¶ÂåÖÂê´ÂÖ≥ÈîÆËØç
            for (let key in keywords) {
                if (message.includes(key)) {
                    const replies = keywords[key];
                    return replies[Math.floor(Math.random() * replies.length)];
                }
            }

            // Â¶ÇÊûúÊ≤°ÊúâÂåπÈÖçÁöÑÂÖ≥ÈîÆËØçÔºåËøîÂõûÈªòËÆ§ÂõûÂ§ç
            return defaultReplies[Math.floor(Math.random() * defaultReplies.length)];
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            addMessage(message, true);
            input.value = '';

            // Âª∂Ëøü‰∏Ä‰∏ãÂÜçÂõûÂ§çÔºåÊ®°ÊãüÊÄùËÄÉ
            setTimeout(() => {
                const reply = getXiaoWangReply(message);
                addMessage(reply, false);
            }, 1000);
        }

        // Ê∑ªÂä†ËÅäÂ§©Áõ∏ÂÖ≥ÁöÑÂáΩÊï∞
        function showChat() {
            document.querySelector('.container').style.display = 'none';
            document.getElementById('chat').style.display = 'flex';
            document.getElementById('browser').style.display = 'none';
            document.getElementById('exitChat').style.display = 'inline-block';
            document.getElementById('openChat').style.display = 'none';
        }

        function exitChat() {
            document.getElementById('chat').style.display = 'none';
            document.getElementById('openChat').style.display = 'inline-block';
            document.getElementById('exitChat').style.display = 'none';
            document.querySelector('.container').style.display = 'flex';
        }

        function addMessage(message, isUser) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
        document.getElementById('openChat').addEventListener('click', showChat);
        document.getElementById('exitChat').addEventListener('click', exitChat);
        document.getElementById('sendMessage').addEventListener('click', sendMessage);
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // ÁÉüËä±ÊïàÊûú
        let fireworksStarted = false;

        function createFirework(x, y) {
            const colors = ['#FF5733', '#FFBD33', '#DBFF33', '#75FF33', '#33FF57', '#33FFBD', '#33DBFF', '#3375FF', '#5733FF', '#BD33FF', '#FF33DB', '#FF3375'];
            const particles = [];

            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: x,
                    y: y,
                    angle: Math.random() * 2 * Math.PI,
                    speed: Math.random() * 5 + 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 3 + 1,
                    life: Math.random() * 30 + 30
                });
            }

            return particles;
        }

        function drawFireworks(context, fireworks) {
            context.clearRect(0, 0, context.canvas.width, context.canvas.height);

            fireworks.forEach((firework, index) => {
                firework.forEach((particle, particleIndex) => {
                    particle.x += Math.cos(particle.angle) * particle.speed;
                    particle.y += Math.sin(particle.angle) * particle.speed;
                    particle.life--;

                    context.fillStyle = particle.color;
                    context.beginPath();
                    context.arc(particle.x, particle.y, particle.size, 0, 2 * Math.PI);
                    context.fill();

                    if (particle.life <= 0) {
                        firework.splice(particleIndex, 1);
                    }
                });

                if (firework.length === 0) {
                    fireworks.splice(index, 1);
                }
            });
        }

        function startFireworks() {
            if (fireworksStarted) return;
            fireworksStarted = true;

            let wishes = [
                "‚ú®Â∞èÂ∞èÊ±™Á•ù‰Ω†2025Âπ¥ÂºÄÂºÄÂøÉÂøÉ‚ú®",
                "üåüÊñ∞ÁöÑ‰∏ÄÂπ¥Ë¶ÅÂÉèÂ∞èÂ∞èÊ±™‰∏ÄÊ†∑ÂãáÊï¢Âì¶üåü",
                "üíñÂ∞èÂ∞èÊ±™Èô™‰Ω†‰∏ÄËµ∑ÊàêÈïøingüíñ",
                "üéà2025Âπ¥‰πüË¶ÅÂíåÂ∞èÂ∞èÊ±™ÂÅöÂ•ΩÊúãÂèãÂëÄüéà",
                "üåàÂ∞èÂ∞èÊ±™ÈÄÅ‰Ω†‰∏Ä‰∏™Â§ßÂ§ßÁöÑÊã•Êä±üåà",
                "‚≠êÊñ∞ÁöÑ‰∏ÄÂπ¥Ë¶ÅÂÉèÊòüÊòü‰∏ÄÊ†∑Èó™‰∫Æ‚≠ê",
                "üéâÁ•ù‰Ω†2025Âπ¥‰∫ã‰∫ãÈ°∫ÂøÉüéâ",
                "üéäÊñ∞Âπ¥Âø´‰πêÔºå‰∏á‰∫ãÂ¶ÇÊÑèüéä",
                "üéÅÊÑø‰Ω†ÊØèÂ§©ÈÉΩÂÖÖÊª°ÊÉäÂñúüéÅ",
                "üåàÊñ∞ÁöÑ‰∏ÄÂπ¥Ë¶ÅÂÉèÂ∞èÂ∞èÊ±™‰∏ÄÊ†∑ÔºåÂãáÊï¢ËøΩÊ¢¶ÔºåÁªôÁîüÊ¥ªÊ∑ªÁÇπËâ≤ÂΩ©Âì¶ÔºÅüåü",
                "üçÄÊñ∞Âπ¥Âà∞ÔºåÂ∞èÂ∞èÊ±™Èô™‰Ω†‰∏ÄËµ∑Âä™ÂäõÔºåËøéÊé•Êõ¥Á≤æÂΩ©ÁöÑÂÜíÈô©ÂêßÔºÅüöÄ",
                "üé∂ÊÑø‰Ω†ÁîüÊ¥ªÂ¶ÇÊ≠åÔºåÂø´‰πêÊó†Âøßüé∂",
                "‚ú®ÊÑø2025Âπ¥ÂÖÖÊª°ÊàëÁöÑÂø´‰πêÈô™‰º¥ÔºåÊØè‰∏ÄÂ§©ÈÉΩÂÉèÂ∞èÂ∞èÊ±™‰∏ÄÊ†∑ÔºåÂÖÉÊ∞îÊª°Êª°ÔºÅ",
                "üåüÊÑø‰Ω†ÁöÑ2025Âπ¥ÂÉèÊòüÊòü‰∏ÄÊ†∑Èó™ËÄÄÔºåÊØè‰∏ÄÂ§©ÈÉΩÊúâÂ∞èÂ∞èÊ±™ÁöÑÈô™‰º¥ÔºÅ",
                "üé†ÊÑø‰Ω†Á´•ÂøÉÊú™Ê≥ØÔºåÂø´‰πêÊó†Âøßüé†",
                "üéáÊÑø‰Ω†ÁîüÊ¥ªÂ¶ÇÁÉüËä±Ëà¨ÁªöÁÉÇüéá"
            ];

            function showWish() {
                if (wishes.length === 0) return;
                const index = Math.floor(Math.random() * wishes.length);
                const wish = wishes.splice(index, 1)[0];
                const text = document.createElement('div');
                text.className = 'firework-text';
                text.textContent = wish;
                text.style.left = Math.random() * (window.innerWidth - 200) + 'px';
                text.style.top = Math.random() * (window.innerHeight - 100) + 'px';
                document.body.appendChild(text);

                // Ê∑°ÂÖ•
                setTimeout(() => {
                    text.classList.add('show');
                }, 100);

                // Ê∑°Âá∫Âπ∂ÁßªÈô§
                setTimeout(() => {
                    text.classList.remove('show');
                    setTimeout(() => text.remove(), 1000);
                }, 2000);
            }

            // ÊØèÁßíÊòæÁ§∫‰∏ÄÊù°Á•ùÁ¶èËØ≠
            const wishInterval = setInterval(showWish, 1000);

            const canvas = document.createElement('canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.style.position = 'fixed';
            canvas.style.top = '0';
            canvas.style.left = '0';
            canvas.style.pointerEvents = 'none';
            canvas.style.zIndex = '1';
            document.body.appendChild(canvas);

            const context = canvas.getContext('2d');
            const fireworks = [];

            // ÂàõÂª∫ÂØÜÈõÜÁöÑÁÉüËä±ÊïàÊûú
            function createRandomFirework() {
                const positions = [
                    { x: Math.random() * canvas.width, y: canvas.height * 0.3 },
                    { x: Math.random() * canvas.width, y: canvas.height * 0.5 },
                    { x: Math.random() * canvas.width, y: canvas.height * 0.7 }
                ];
                
                positions.forEach(pos => {
                    fireworks.push(createFirework(pos.x, pos.y));
                });
            }

            // ÂàùÂßãÂåñÊõ¥Â§öÁÉüËä±
            for (let i = 0; i < 5; i++) {
                createRandomFirework();
            }

            // ÊØèÈöî‰∏ÄÊÆµÊó∂Èó¥ÂàõÂª∫‰∏ÄÊâπÁÉüËä±
            const fireworkInterval = setInterval(() => {
                if (Math.random() < 0.6) { // ÊèêÈ´òÂàõÂª∫Ê¶ÇÁéáÂà∞60%
                    createRandomFirework();
                }
            }, 300); // Áº©Áü≠Èó¥ÈöîÊó∂Èó¥

            // 10ÁßíÂêéÂÅúÊ≠¢ÁÉüËä±ÊïàÊûú
            setTimeout(() => {
                clearInterval(fireworkInterval);
                clearInterval(wishInterval);
                fireworksStarted = false;
                const texts = document.querySelectorAll('.firework-text');
                texts.forEach(text => {
                    text.classList.remove('show');
                    setTimeout(() => text.remove(), 1000);
                });
                // Ê∑°Âá∫ÊïàÊûú
                const fadeOut = setInterval(() => {
                    canvas.style.opacity = Number(canvas.style.opacity || 1) - 0.1;
                    if (Number(canvas.style.opacity) <= 0) {
                        clearInterval(fadeOut);
                        canvas.remove();
                    }
                }, 100);

                // ÊòæÁ§∫ÊúÄÂ§ßÁöÑÁ•ùÁ¶èËØ≠
                showFinalWish();
            }, 10000);

            // ÁÇπÂáª‰∫ßÁîüÊõ¥Â§ßÁöÑÁÉüËä±
            canvas.addEventListener('click', (e) => {
                const x = e.clientX;
                const y = e.clientY;
                // ÂàõÂª∫‰∏Ä‰∏™Êõ¥Â§ßÁöÑÁÉüËä±
                const largeFirework = createFirework(x, y);
                largeFirework.forEach(particle => {
                    particle.size *= 2;
                    particle.speed *= 1.5;
                    particle.life *= 1.2;
                });
                fireworks.push(largeFirework);
            });

            function animate() {
                drawFireworks(context, fireworks);
                if (fireworksStarted) {
                    requestAnimationFrame(animate);
                }
            }

            animate();
        }

        function showFinalWish() {
            const finalWish = document.createElement('div');
            finalWish.className = 'firework-text';
            finalWish.textContent = "üåàüçÄÊàë‰ª¨ÊÄªÊòØË¶ÅÂÜçËßÅÔºå‰∏∫‰∫ÜÂÜçËßÅ üòäüåº";
            finalWish.style.position = 'absolute';
            finalWish.style.top = '50px';
            finalWish.style.left = '50%';
            finalWish.style.transform = 'translateX(-50%)';
            finalWish.style.fontSize = '72px';
            finalWish.style.zIndex = '3';
            finalWish.style.whiteSpace = 'nowrap'; // ‰∏çÊç¢Ë°å 
            document.body.appendChild(finalWish);

            // Ê∑°ÂÖ•
            setTimeout(() => {
                finalWish.classList.add('show');
            }, 100);

            // ÊåÅÁª≠‰∏âÁßíÂêéÊ∑°Âá∫Âπ∂ÁßªÈô§
            setTimeout(() => {
                finalWish.classList.remove('show');
                setTimeout(() => finalWish.remove(), 1000);
            }, 3000);

            // Ê∑ªÂä†Á¨¨‰∫åË°åÊñáÂ≠ó
            const secondWish = document.createElement('div');
            secondWish.className = 'firework-text';
            secondWish.textContent = "bye~ 2024";
            secondWish.style.position = 'absolute';
            secondWish.style.top = '150px';
            secondWish.style.left = '50%';
            secondWish.style.transform = 'translateX(-50%)';
            secondWish.style.fontSize = '72px';
            secondWish.style.zIndex = '3';
            secondWish.style.whiteSpace = 'nowrap'; // ‰∏çÊç¢Ë°å 
            document.body.appendChild(secondWish);

            // Ê∑°ÂÖ•
            setTimeout(() => {
                secondWish.classList.add('show');
            }, 100);

            // ÊåÅÁª≠‰∏âÁßíÂêéÊ∑°Âá∫Âπ∂ÁßªÈô§
            setTimeout(() => {
                secondWish.classList.remove('show');
                setTimeout(() => secondWish.remove(), 1000);
            }, 3000);
        }

        document.getElementById('fireworksButton').addEventListener('click', startFireworks);
    </script>
</body>
</html>
